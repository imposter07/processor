{% extends "base.html" %}

{% block vertical_navbar %}
    <h1 class="sidebar-heading d-flex justify-content-between align-items-center
               text-light">
                  <span>{{ _('User') }}: {{ user.username }}</span>
    </h1>
    <button class="btn btn-outline-success btn-lg btn-block text-left"
            type="button" href="{{ url_for('main.create_processor') }}">
                <i class="fas fa-plus-circle" href="#" role="button"></i>
                {{ _('Create Processor') }}
    </button>
    <table class="table table-hover">
        <tr>
            <td>
                <div class="input-group">
                  <select class="custom-select" id="inputGroupSelect04">
                    <option selected>Choose...</option>
                      {% for processor in processors %}
                          <option value="{{ processor.name }}">
                              {{ processor.name }}</option>
                      {% endfor %}
                  </select>
                </div>
            </td>
        </tr>
    </table>
{% endblock %}

{% block app_content %}
    <div id="carousel" class="carousel slide" data-ride="carousel" data-interval="false">
        <div class="carousel-inner">
            {% for processor in processors %}
                {% with loop_num = loop.index %}
                    {% include '_processor.html' %}
                {% endwith %}
            {% endfor %}
          <a class="carousel-control-prev" href="#carousel" role="button" data-slide="prev">
            <i class="fas fa-arrow-alt-circle-left btn btn-dark btn-lg"></i>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carousel" role="button" data-slide="next">
            <i class="fas fa-arrow-alt-circle-right btn btn-dark btn-lg"></i>
            <span class="sr-only">Next</span>
          </a>
        </div>
    </div>
    {% for post in posts %}
        {% include '_post.html' %}
    {% endfor %}
    <nav aria-label="...">
        <ul class="pagination justify-content-center">
            <li class="page-item{% if not prev_url %} page-item disabled{% endif %}">
                <a class="page-link" href="{{ prev_url or '#' }}">
                    <span aria-hidden="true">&larr;</span> {{ _('Newer processors') }}
                </a>
            </li>
            <li class="page-item{% if not next_url %} page-item disabled{% endif %}">
                <a class="page-link" href="{{ next_url or '#' }}">
                    {{ _('Older processors') }} <span aria-hidden="true">&rarr;</span>
                </a>
            </li>
        </ul>
    </nav>
    <script>
            $(document).ready(function() {
            $('a[id^="editTable"]').click(function () {
                var tableName = this.id.replace('editTable', '');
                var dropdownButton = "#" + $(this).parents()[2].children[0].id;
                $(dropdownButton).prop("disabled", true);
                var oldHtml = $(dropdownButton).html();
                $(dropdownButton).html(
                    `<span class="spinner-grow spinner-grow-sm" role="status"
                      aria-hidden="true"></span> Loading...`
                  );
                animateBar();
                getTable(tableName, dropdownButton, oldHtml);
            });
        });
        function getTable(tableName, clickElem, oldHtml){
            $.post('/get_table',
                {
                    table: tableName,
                    processor:  "{{ processor_name }}"
            }).done(function(data, status) {
                show_modal_table('tableModalButton');
                var newTableName = data['data']['name'];
                createTable(data['data']['cols'], data['data']['data'],
                    newTableName);
            }).fail(function() {
                console.log('fail')
            }).always(function(){
                $(clickElem).prop("disabled", false);
                $(clickElem).html(oldHtml);
                unanimateBar();
            });
        }
    </script>
{% endblock %}
