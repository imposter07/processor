{% extends "base.html" %}

{% block vertical_navbar %}
    <h1 class="sidebar-heading d-flex justify-content-between align-items-center
               text-light">
                  <span>{{ _('User') }}: {{ user.username }}</span>
    </h1>
    <a href="{{ url_for('main.create_processor') }}">
        <button class="btn btn-outline-success btn-lg btn-block text-left"
            type="button" href="{{ url_for('main.create_processor') }}">
                <i class="fas fa-plus-circle"
                   role="button"></i>
                {{ _('Create Processor') }}
    </button></a><br>
    <div class="custom-control custom-switch" id="customSwitchDiv">
      <input type="checkbox" class="custom-control-input" id="customSwitch1" checked>
      <label class="custom-control-label" for="customSwitch1">
          {{ _("Processors I've Created") }}</label>
    </div>
    <table class="table table-hover">
        <tr>
            <td>
                <div class="input-group">
                  <select class="custom-select" id="inputGroupSelect04">
                    <option selected>{{ _("Choose...") }}</option>
                      {% for processor in processors %}
                          <option value="{{ processor.name }}" index="">
                              {{ processor.name }}</option>
                      {% endfor %}
                  </select>
                </div>
            </td>
        </tr>
    </table>
{% endblock %}

{% block app_header %}

{% endblock %}
{% block app_content %}
    <div id="carousel" class="carousel slide" data-ride="carousel"
         data-interval="false">
        <div class="carousel-inner text-center">
            {% for processor in processors %}
                {% with loop_num = loop.index %}
                    {% include '_processor.html' %}
                {% endwith %}
            {% endfor %}
          <a class="carousel-control-prev" href="#carousel"
             role="button" data-slide="prev">
            <i class="fas fa-arrow-alt-circle-left btn btn-dark btn-lg"></i>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carousel"
             role="button" data-slide="next">
            <i class="fas fa-arrow-alt-circle-right btn btn-dark btn-lg"></i>
            <span class="sr-only">Next</span>
          </a>
        </div>
    </div>
    {% for post in posts %}
        {% include '_post.html' %}
    {% endfor %}
    <script>
        $(document).ready(function() {
            $('select').on('change', function(e){
                $('#carousel').carousel($(this)[0].selectedIndex - 1);
            });
        });
        $(document).ready(function() {
            $('a[id^="editTable"]').click(function () {
                var tableName = this.id.replace('editTable', '');
                var dropdownButton = "#" + $(this).parents()[2].children[0].id;
                $(dropdownButton).prop("disabled", true);
                var oldHtml = $(dropdownButton).html();
                $(dropdownButton).html(
                    `<span class="spinner-grow spinner-grow-sm" role="status"
                      aria-hidden="true"></span> Loading...`
                  );
                animateBar();
                getTable(tableName, dropdownButton, oldHtml);
            });
        });
        $(document).ready(function() {
            $('a[id^="customSwitch1"]').click(function () {
                console.log('siwtch pressed');
                var elementName = this.id;
                console.log(elementName);
            });
        });
        function getTable(tableName, clickElem, oldHtml){
            $.post('/get_table',
                {
                    table: tableName,
                    processor:  "{{ processor_name }}"
            }).done(function(data, status) {
                show_modal_table('tableModalButton');
                var newTableName = data['data']['name'];
                createTable(data['data']['cols'], data['data']['data'],
                    newTableName);
            }).fail(function() {
                console.log('fail')
            }).always(function(){
                $(clickElem).prop("disabled", false);
                $(clickElem).html(oldHtml);
                unanimateBar();
            });
        }
    </script>
{% endblock %}